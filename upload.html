<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒŒì¼ ì—…ë¡œë“œ - VOC ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .nav {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .nav a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .nav a:hover, .nav a.active {
            background: rgba(255,255,255,0.3);
        }
        
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        /* Q-data ì„¹ì…˜ ê°•ì¡° */
        .upload-section.qdata-section {
            border: 2px solid #ff6b6b;
            background: #fff5f5;
        }
        
        .badge-new {
            background: #ff6b6b;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .upload-section h2 {
            color: #333;
            margin-bottom: 10px;
            font-size: 20px;
            display: flex;
            align-items: center;
        }
        
        .upload-section p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .upload-box {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-box:hover {
            background: #f0f2ff;
            border-color: #5568d3;
        }
        
        .upload-box.dragging {
            background: #e8ebff;
            border-color: #5568d3;
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .upload-text {
            color: #666;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .file-info {
            color: #999;
            font-size: 14px;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .selected-file {
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 5px;
            display: none;
        }
        
        .selected-file.show {
            display: block;
        }
        
        .selected-file-name {
            color: #2e7d32;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .selected-file-size {
            color: #666;
            font-size: 14px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-left: 10px;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .message {
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
        
        .message.show {
            display: block;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
            display: none;
        }
        
        .progress-bar.show {
            display: block;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        .info-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .info-box h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-box ul {
            color: #856404;
            padding-left: 20px;
            line-height: 1.8;
        }
        
        .info-box strong {
            color: #721c24;
        }
        
        .example-table {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        
        .example-table table {
            border-collapse: collapse;
            width: 100%;
        }
        
        .example-table th,
        .example-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .example-table th {
            background: #f8f9fa;
            font-weight:  600;
        }
        
        /* ë¯¸ë§¤í•‘ ëª¨ë¸ëª… ê´€ë¦¬ ì„¹ì…˜ */
        .unmapped-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .unmapped-section h2 {
            color: #856404;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .unmapped-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .unmapped-table th,
        .unmapped-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .unmapped-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .unmapped-table tr:hover {
            background: #f8f9fa;
        }
        
        .unmapped-table .model-name {
            font-weight: 600;
            color: #333;
        }
        
        .unmapped-table .count {
            color: #ff6b6b;
            font-weight: 600;
        }
        
        .unmapped-table .chipset-input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            width: 200px;
        }
        
        .unmapped-table .btn-add {
            padding: 5px 10px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 5px;
        }
        
        .unmapped-table .btn-add:hover {
            background: #218838;
        }
        
        .quick-add-section {
            background: #e8f5e9;
            border: 1px solid #d4edda;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .quick-add-section h4 {
            color: #155724;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .input-group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .input-group button {
            padding: 8px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .input-group button:hover {
            background: #218838;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .btn-warning:hover {
            background: #e0a800;
            color: #856404;
        }
        
        .upload-history {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 5px;
            font-size: 13px;
            color: #155724;
            display: none;
        }
        
        .upload-history.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ VOC í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        <div class="nav">
            <a href="/">ëŒ€ì‹œë³´ë“œ</a>
            <a href="/upload" class="active">íŒŒì¼ ì—…ë¡œë“œ</a>
            <a href="/statistics">í†µê³„ ë¶„ì„</a>
        </div>
    </div>
    
    <div class="container">
        <!-- ë¯¸ë§¤í•‘ ëª¨ë¸ëª… ê´€ë¦¬ -->
        <div class="unmapped-section" id="unmappedSection" style="display: none;">
            <h2>âš ï¸ ì¹©ì…‹ ë¯¸ë§¤í•‘ ëª¨ë¸ëª… ê´€ë¦¬</h2>
            <p>ì¹©ì…‹ì´ ë§¤í•‘ë˜ì§€ ì•Šì€ ëª¨ë¸ëª…ì„ í™•ì¸í•˜ê³  ì§ì ‘ ì¹©ì…‹ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            
            <div class="unmapped-table-container">
                <table class="unmapped-table">
                    <thead>
                        <tr>
                            <th>ëª¨ë¸ëª…</th>
                            <th>VOC ê±´ìˆ˜</th>
                            <th>ì¹©ì…‹ ì…ë ¥</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody id="unmappedModelsBody">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                    </tbody>
                </table>
            </div>
            
            <div class="quick-add-section">
                <h4>ğŸš€ ë¹ ë¥¸ ì¹©ì…‹ ë§¤í•‘ ì¶”ê°€</h4>
                <div class="input-group">
                    <input type="text" id="modelName" placeholder="ëª¨ë¸ëª… (ì˜ˆ: SM-S921N)">
                    <input type="text" id="chipsetName" placeholder="ì¹©ì…‹ëª… (ì˜ˆ: Snapdragon 8 Gen 1)">
                    <button onclick="addChipsetMapping()">ì¶”ê°€</button>
                </div>
                <div class="input-group">
                    <button class="btn btn-warning" onclick="refreshUnmappedModels()">ğŸ”„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                </div>
            </div>
        </div>
        
        <!-- ì‚¬ë‚´ VOC ì—…ë¡œë“œ -->
        <div class="upload-section">
            <h2>ğŸ“Š ì‚¬ë‚´ VOC íŒŒì¼ ì—…ë¡œë“œ</h2>
            <p>ì‚¬ë‚´ VOC ë°ì´í„°ê°€ í¬í•¨ëœ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”. (DRM íŒŒì¼ ì§€ì›)</p>
            
            <div class="upload-box" id="vocUploadBox" onclick="document.getElementById('vocFile').click()">
                <div class="upload-icon">ğŸ“„</div>
                <div class="upload-text">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë¡­í•˜ì„¸ìš”</div>
                <div class="file-info">ì—‘ì…€ íŒŒì¼ (.xlsx, .xls) - DRM íŒŒì¼ ì§€ì›</div>
            </div>
            
            <input type="file" id="vocFile" accept=".xlsx,.xls" onchange="handleFileSelect('voc', this.files[0])">
            
            <div class="selected-file" id="vocSelectedFile">
                <div class="selected-file-name" id="vocFileName"></div>
                <div class="selected-file-size" id="vocFileSize"></div>
            </div>
            
            <div class="progress-bar" id="vocProgress">
                <div class="progress-fill" id="vocProgressFill">0%</div>
            </div>
            
            <button class="btn btn-primary" id="vocUploadBtn" onclick="uploadFile('voc')" disabled>
                ì—…ë¡œë“œ
            </button>
            <button class="btn btn-secondary" onclick="clearFile('voc')">ì·¨ì†Œ</button>
            
            <div class="message" id="vocMessage"></div>
            
            <div class="info-box">
                <h4>ğŸ“‹ ì‚¬ë‚´ VOC íŒŒì¼ êµ¬ì¡°</h4>
                <ul>
                    <li>Aì—´: ì‚¬ë¡€ì½”ë“œ (ì˜ˆ: P230710-12345)</li>
                    <li>Hì—´: title (ëª¨ë¸ëª… í¬í•¨)</li>
                    <li>Mì—´: ë¬¸ì œì  ([Model No.] í¬í•¨ ê°€ëŠ¥)</li>
                    <li>Nì—´: ì¬í˜„ê²½ë¡œ ([Original Contents], [Build No.], [OS Ver.] í¬í•¨)</li>
                    <li>Oì—´: í•´ê²°ì</li>
                    <li>Rì—´: Resolve Option</li>
                    <li>Uì—´: ì›ì¸</li>
                    <li>Vì—´: ëŒ€ì±…</li>
                </ul>
            </div>
        </div>
        
        <!-- Q-data ì—…ë¡œë“œ (NEW) -->
        <div class="upload-section qdata-section">
            <h2>ğŸ”§ Q-data íŒŒì¼ ì—…ë¡œë“œ<span class="badge-new">NEW</span></h2>
            <p>Q-data (í’ˆì§ˆ ë°ì´í„°) ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”. (DRM íŒŒì¼ ì§€ì›)</p>
            
            <div class="upload-box" id="qdataUploadBox" onclick="document.getElementById('qdataFile').click()">
                <div class="upload-icon">ğŸ“„</div>
                <div class="upload-text">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë¡­í•˜ì„¸ìš”</div>
                <div class="file-info">ì—‘ì…€ íŒŒì¼ (.xlsx, .xls) - DRM íŒŒì¼ ì§€ì› (ìµœëŒ€ 8ê°€ì§€ ë°©ë²• ì‹œë„)</div>
            </div>
            
            <input type="file" id="qdataFile" accept=".xlsx,.xls" onchange="handleFileSelect('qdata', this.files[0])">
            
            <div class="selected-file" id="qdataSelectedFile">
                <div class="selected-file-name" id="qdataFileName"></div>
                <div class="selected-file-size" id="qdataFileSize"></div>
            </div>
            
            <div class="progress-bar" id="qdataProgress">
                <div class="progress-fill" id="qdataProgressFill">0%</div>
            </div>
            
            <button class="btn btn-primary" id="qdataUploadBtn" onclick="uploadFile('qdata')" disabled>
                ì—…ë¡œë“œ
            </button>
            <button class="btn btn-secondary" onclick="clearFile('qdata')">ì·¨ì†Œ</button>
            
            <div class="message" id="qdataMessage"></div>
            
            <div class="upload-history" id="qdataHistory"></div>
            
            <div class="info-box">
                <h4>ğŸ“‹ Q-data íŒŒì¼ êµ¬ì¡°</h4>
                <p><strong>âš ï¸ ì£¼ì˜ì‚¬í•­:</strong></p>
                <ul>
                    <li><strong>9í–‰ë¶€í„° ë°ì´í„°ê°€ ì‹œì‘</strong>ë˜ì–´ì•¼ í•©ë‹ˆë‹¤ (1~8í–‰ì€ í—¤ë”)</li>
                    <li>DRMì´ ê±¸ë¦° íŒŒì¼ë„ ì§€ì›ë©ë‹ˆë‹¤ (ìµœëŒ€ 8ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ìë™ ì²˜ë¦¬)</li>
                    <li>ì¤‘ë³µ ë°ì´í„°(ë™ì¼ S/N + LOG ID)ëŠ” ìë™ìœ¼ë¡œ ì œì™¸ë©ë‹ˆë‹¤</li>
                </ul>
                <h4 style="margin-top: 15px;">í•„ìˆ˜ ì»¬ëŸ¼:</h4>
                <ul>
                    <li>Fì—´: ì„œë¹„ìŠ¤ì¼ì (YYMMDD í˜•ì‹, ì˜ˆ: 260209 â†’ 2026-02-09)</li>
                    <li>Mì—´: ì²˜ë¦¬ìœ í˜• (ìì¬ë¯¸ì‚¬ìš©/ìì¬ì‚¬ìš©/ë°˜í’ˆ)</li>
                    <li>Pì—´: ìˆ˜ë¦¬ëª… (8ê°€ì§€ ìœ í˜•)</li>
                    <li>Qì—´: ìˆ˜ë¦¬ ì„¸ë¶€ ë‚´ìš©</li>
                    <li>Tì—´: ìƒì„¸ë‚´ìš©</li>
                    <li>Zì—´: ëª¨ë¸ëª… (ì˜ˆ: SM-S901N)</li>
                    <li>ADì—´: S/N (ê³ ìœ ë²ˆí˜¸)</li>
                    <li>ARì—´: LOG ID (ê³ ìœ ë²ˆí˜¸)</li>
                    <li>BEì—´: ìˆ˜ë¦¬ì „ S/W</li>
                    <li>BFì—´: ìˆ˜ë¦¬ S/W</li>
                </ul>
            </div>
        </div>
        
        <!-- ì¹©ì…‹ ë§¤í•‘ ì—…ë¡œë“œ -->
        <div class="upload-section">
            <h2>ğŸ’» ì¹©ì…‹ ë§¤í•‘ íŒŒì¼ ì—…ë¡œë“œ</h2>
            <p>ëª¨ë¸ëª…ê³¼ ì¹©ì…‹ì„ ë§¤í•‘í•˜ëŠ” ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
            
            <div class="upload-box" id="chipsetUploadBox" onclick="document.getElementById('chipsetFile').click()">
                <div class="upload-icon">ğŸ“„</div>
                <div class="upload-text">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë¡­í•˜ì„¸ìš”</div>
                <div class="file-info">ì—‘ì…€ íŒŒì¼ (.xlsx, .xls)</div>
            </div>
            
            <input type="file" id="chipsetFile" accept=".xlsx,.xls" onchange="handleFileSelect('chipset', this.files[0])">
            
            <div class="selected-file" id="chipsetSelectedFile">
                <div class="selected-file-name" id="chipsetFileName"></div>
                <div class="selected-file-size" id="chipsetFileSize"></div>
            </div>
            
            <div class="progress-bar" id="chipsetProgress">
                <div class="progress-fill" id="chipsetProgressFill">0%</div>
            </div>
            
            <button class="btn btn-primary" id="chipsetUploadBtn" onclick="uploadFile('chipset')" disabled>
                ì—…ë¡œë“œ
            </button>
            <button class="btn btn-secondary" onclick="clearFile('chipset')">ì·¨ì†Œ</button>
            
            <div class="message" id="chipsetMessage"></div>
            
            <div class="info-box">
                <h4>ğŸ“‹ ì¹©ì…‹ ë§¤í•‘ íŒŒì¼ í˜•ì‹</h4>
                <ul>
                    <li>ì²« ë²ˆì§¸ ì—´: ëª¨ë¸ëª… (ì˜ˆ: SM-S901N)</li>
                    <li>ë‘ ë²ˆì§¸ ì—´: ì¹©ì…‹ëª… (ì˜ˆ: Snapdragon 8 Gen 1)</li>
                </ul>
                <div class="example-table">
                    <table>
                        <tr>
                            <th>ëª¨ë¸ëª…</th>
                            <th>ì¹©ì…‹</th>
                        </tr>
                        <tr>
                            <td>SM-S901N</td>
                            <td>Snapdragon 8 Gen 1</td>
                        </tr>
                        <tr>
                            <td>SM-S908N</td>
                            <td>Snapdragon 8 Gen 1</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 3rd Party ì•± í‚¤ì›Œë“œ ì—…ë¡œë“œ -->
        <div class="upload-section">
            <h2>ğŸ“² 3rd Party ì•± í‚¤ì›Œë“œ ì—…ë¡œë“œ</h2>
            <p>ì•± ì´ë¦„ê³¼ ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ë§¤í•‘í•˜ëŠ” ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
            
            <div class="upload-box" id="appUploadBox" onclick="document.getElementById('appFile').click()">
                <div class="upload-icon">ğŸ“„</div>
                <div class="upload-text">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë¡­í•˜ì„¸ìš”</div>
                <div class="file-info">ì—‘ì…€ íŒŒì¼ (.xlsx, .xls)</div>
            </div>
            
            <input type="file" id="appFile" accept=".xlsx,.xls" onchange="handleFileSelect('app', this.files[0])">
            
            <div class="selected-file" id="appSelectedFile">
                <div class="selected-file-name" id="appFileName"></div>
                <div class="selected-file-size" id="appFileSize"></div>
            </div>
            
            <div class="progress-bar" id="appProgress">
                <div class="progress-fill" id="appProgressFill">0%</div>
            </div>
            
            <button class="btn btn-primary" id="appUploadBtn" onclick="uploadFile('app')" disabled>
                ì—…ë¡œë“œ
            </button>
            <button class="btn btn-secondary" onclick="clearFile('app')">ì·¨ì†Œ</button>
            
            <div class="message" id="appMessage"></div>
            
            <div class="info-box">
                <h4>ğŸ“‹ 3rd Party ì•± í‚¤ì›Œë“œ íŒŒì¼ í˜•ì‹</h4>
                <ul>
                    <li>ì²« ë²ˆì§¸ ì—´: ì•± ì´ë¦„ (ì˜ˆ: í‹°ë§µ)</li>
                    <li>ë‘ ë²ˆì§¸ ì—´: ê²€ìƒ‰ í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„, ì˜ˆ: í‹°ë§µ,tmap,Të§µ)</li>
                </ul>
                <div class="example-table">
                    <table>
                        <tr>
                            <th>ì•± ì´ë¦„</th>
                            <th>ê²€ìƒ‰ í‚¤ì›Œë“œ</th>
                        </tr>
                        <tr>
                            <td>í‹°ë§µ</td>
                            <td>í‹°ë§µ,tmap,Të§µ</td>
                        </tr>
                        <tr>
                            <td>ì¹´ì¹´ì˜¤ë‚´ë¹„</td>
                            <td>ì¹´ì¹´ì˜¤ë‚´ë¹„,ì¹´ì¹´ì˜¤ ë‚´ë¹„,kakao navi</td>
                        </tr>
                        <tr>
                            <td>ë„¤ì´ë²„ì§€ë„</td>
                            <td>ë„¤ì´ë²„ì§€ë„,ë„¤ì´ë²„ ì§€ë„,naver map</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const files = {
            chipset: null,
            app: null,
            voc: null,
            qdata: null  // Q-data ì¶”ê°€
        };
        
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        ['chipsetUploadBox', 'appUploadBox', 'vocUploadBox', 'qdataUploadBox'].forEach(id => {
            const box = document.getElementById(id);
            
            box.addEventListener('dragover', (e) => {
                e.preventDefault();
                box.classList.add('dragging');
            });
            
            box.addEventListener('dragleave', () => {
                box.classList.remove('dragging');
            });
            
            box.addEventListener('drop', (e) => {
                e.preventDefault();
                box.classList.remove('dragging');
                
                const type = id.replace('UploadBox', '');
                const file = e.dataTransfer.files[0];
                handleFileSelect(type, file);
            });
        });
        
        function handleFileSelect(type, file) {
            if (!file) return;
            
            if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                showMessage(type, 'ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            files[type] = file;
            
            document.getElementById(`${type}FileName`).textContent = file.name;
            document.getElementById(`${type}FileSize`).textContent = 
                `íŒŒì¼ í¬ê¸°: ${(file.size / 1024 / 1024).toFixed(2)} MB`;
            document.getElementById(`${type}SelectedFile`).classList.add('show');
            document.getElementById(`${type}UploadBtn`).disabled = false;
            
            hideMessage(type);
        }
        
        function clearFile(type) {
            files[type] = null;
            document.getElementById(`${type}File`).value = '';
            document.getElementById(`${type}SelectedFile`).classList.remove('show');
            document.getElementById(`${type}UploadBtn`).disabled = true;
            document.getElementById(`${type}Progress`).classList.remove('show');
            hideMessage(type);
            
            // Q-data íˆìŠ¤í† ë¦¬ ìˆ¨ê¹€
            if (type === 'qdata') {
                document.getElementById('qdataHistory').classList.remove('show');
            }
        }
        
        async function uploadFile(type) {
            const file = files[type];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            
            const uploadBtn = document.getElementById(`${type}UploadBtn`);
            uploadBtn.disabled = true;
            
            // Q-dataëŠ” DRM ì²˜ë¦¬ ì•ˆë‚´ í‘œì‹œ
            if (type === 'qdata') {
                uploadBtn.textContent = 'DRM ì²˜ë¦¬ ì¤‘...';
            } else {
                uploadBtn.textContent = 'ì—…ë¡œë“œ ì¤‘...';
            }
            
            const progressBar = document.getElementById(`${type}Progress`);
            const progressFill = document.getElementById(`${type}ProgressFill`);
            progressBar.classList.add('show');
            
            // ì§„í–‰ë¥  ì• ë‹ˆë©”ì´ì…˜
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                if (progress >= 90) {
                    clearInterval(interval);
                }
                progressFill.style.width = progress + '%';
                progressFill.textContent = progress + '%';
            }, 100);
            
            try {
                const endpoints = {
                    chipset: '/api/upload/chipset_mapping',
                    app: '/api/upload/app_keywords',
                    voc: '/api/upload/internal_voc',
                    qdata: '/api/upload/qdata'  // Q-data ì—”ë“œí¬ì¸íŠ¸
                };
                
                const response = await fetch(endpoints[type], {
                    method: 'POST',
                    body: formData
                });
                
                clearInterval(interval);
                progressFill.style.width = '100%';
                progressFill.textContent = '100%';
                
                const data = await response.json();
                
                if (response.ok) {
                    let successMessage = data.message;
                    
                    // Q-data ìƒì„¸ ì •ë³´ í‘œì‹œ
                    if (type === 'qdata' && data.inserted !== undefined) {
                        successMessage = `âœ… ${data.message}\nğŸ“Š ì €ì¥: ${data.inserted}ê±´ | ì¤‘ë³µ ì œì™¸: ${data.duplicates}ê±´`;
                        
                        // ì—…ë¡œë“œ ì´ë ¥ í‘œì‹œ
                        const now = new Date().toLocaleString('ko-KR');
                        const historyDiv = document.getElementById('qdataHistory');
                        historyDiv.textContent = `ğŸ“… ë§ˆì§€ë§‰ ì—…ë¡œë“œ: ${now} (${data.inserted}ê±´ ì €ì¥)`;
                        historyDiv.classList.add('show');
                    }
                    
                    showMessage(type, successMessage, 'success');
                    
                    // VOC ë˜ëŠ” ì¹©ì…‹ ë§¤í•‘ ì—…ë¡œë“œ ì„±ê³µ ì‹œ ë¯¸ë§¤í•‘ ëª¨ë¸ëª… ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    if (type === 'voc' || type === 'chipset') {
                        setTimeout(() => {
                            loadUnmappedModels();
                        }, 2000);
                    }
                    
                    setTimeout(() => {
                        clearFile(type);
                    }, 3000);
                } else {
                    showMessage(type, data.error || 'ì—…ë¡œë“œ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                clearInterval(interval);
                showMessage(type, 'ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'ì—…ë¡œë“œ';
            }
        }
        
        function showMessage(type, text, messageType) {
            const message = document.getElementById(`${type}Message`);
            message.textContent = text;
            message.className = `message show ${messageType}`;
        }
        
        function hideMessage(type) {
            const message = document.getElementById(`${type}Message`);
            message.classList.remove('show');
        }
        
        // ë¯¸ë§¤í•‘ ëª¨ë¸ëª… ê´€ë¦¬ ê¸°ëŠ¥
        async function loadUnmappedModels() {
            try {
                const response = await fetch('/api/unmapped-models');
                const data = await response.json();
                
                if (data.success && data.total_unmapped > 0) {
                    document.getElementById('unmappedSection').style.display = 'block';
                    
                    const tbody = document.getElementById('unmappedModelsBody');
                    tbody.innerHTML = '';
                    
                    data.unmapped_models.forEach(model => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="model-name">${model.model_name}</td>
                            <td class="count">${model.count}</td>
                            <td>
                                <input type="text" class="chipset-input" 
                                       id="chipset-${model.model_name}" 
                                       placeholder="ì¹©ì…‹ëª… ì…ë ¥">
                            </td>
                            <td>
                                <button class="btn-add" onclick="addChipsetForModel('${model.model_name}')">
                                    ì¶”ê°€
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    document.getElementById('unmappedSection').style.display = 'none';
                }
            } catch (error) {
                console.error('ë¯¸ë§¤í•‘ ëª¨ë¸ëª… ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        async function addChipsetForModel(modelName) {
            const chipsetInput = document.getElementById(`chipset-${modelName}`);
            const chipset = chipsetInput.value.trim();
            
            if (!chipset) {
                alert('ì¹©ì…‹ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const response = await fetch('/api/chipset-mapping/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model_name: modelName,
                        chipset: chipset
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(data.message);
                    loadUnmappedModels();
                } else {
                    alert('ì¶”ê°€ ì‹¤íŒ¨: ' + data.error);
                }
            } catch (error) {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        }
        
        async function addChipsetMapping() {
            const modelName = document.getElementById('modelName').value.trim();
            const chipsetName = document.getElementById('chipsetName').value.trim();
            
            if (!modelName || !chipsetName) {
                alert('ëª¨ë¸ëª…ê³¼ ì¹©ì…‹ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const response = await fetch('/api/chipset-mapping/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model_name: modelName,
                        chipset: chipsetName
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(data.message);
                    document.getElementById('modelName').value = '';
                    document.getElementById('chipsetName').value = '';
                    loadUnmappedModels();
                } else {
                    alert('ì¶”ê°€ ì‹¤íŒ¨: ' + data.error);
                }
            } catch (error) {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        }
        
        function refreshUnmappedModels() {
            loadUnmappedModels();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¯¸ë§¤í•‘ ëª¨ë¸ëª… ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadUnmappedModels();
        });
    </script>
</body>
</html>
